<!DOCTYPE html>
<html>
<head>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
  <meta charset="utf-8">
  <title>Cryptosystem</title>

  <style>
    .row {
      padding-left: 50px;
      padding-right: 50px;
      padding-top: 25px;
    }

  </style>

</head>
<body>

  <!-- <div class="jumbotron text-center">
      <h1>Cryptanalysis</h1>
      <p>The following will allow you to crack the key used for Columnar Transpostion given the plaintext and corresponding ciphertext.</p>
  </div>

  <div class="row">
    <div class="col form-group text-center">
      <label for="plaintext">Plaintext:</label>
      <textarea class="form-control" rows="5" id="plaintext"></textarea>
    </div>
    <div class="col form-group text-center">
      <label for="ciphertext">Ciphertext:</label>
      <textarea class="form-control" rows="5" id="ciphertext"></textarea>
    </div>
  </div> -->

  <div class="jumbotron text-center">
      <h1>RSA Cryptosystem</h1>
      <p>The following will allow you to Generate a public and private key pair, decrypt, and encrypt your message.</p>
  </div>

  <h2 class="text-center">Generate RSA Key</h2>
  <div class="row">
    <div class="col form-group text-center">
      <button onclick="genPubKey(event)" type="button" class="btn btn-primary">Generate Public Key</button>
      <br></br>
      <textarea class="form-control" rows="5" id="pubKey"></textarea>
    </div>
    <div class="col form-group text-center">
      <button onclick="genPriKey(event)" type="button" class="btn btn-primary">Generate Private Key</button>
      <br></br>
      <textarea class="form-control" rows="5" id="priKey"></textarea>
    </div>
  </div>

  <h2 class="text-center">RSA Encryption/Decryption</h2>
  <div class="row">
    <div class="col form-group">
      <h3>RSA Encryption</h3>
      <label for="encrypt">Enter Plaintext for Encryption</label>
      <textarea class="form-control" rows="5" id="encrypt"></textarea>
    </div>
    <div class="col form-group">
      <h3>RSA Decryption</h3>
      <label for="decrypt">Enter Encrypted Text for Decryption:</label>
      <textarea class="form-control" rows="5" id="decrypt"></textarea>

    </div>
  </div>

  <div class="row">
    <div class="col form-group">
      <label for="encrypt">Enter Public/Private Key:</label>
      <textarea class="form-control" rows="5" id="encrypt"></textarea>
      <br></br>
      <button onclick="" type="button" class="btn btn-primary">Encrypt</button>
    </div>
    <div class="col form-group">
      <label for="decrypt">Enter Public/Private Key:</label>
      <textarea class="form-control" rows="5" id="decrypt"></textarea>
      <br></br>
      <button onclick="" type="button" class="btn btn-primary">Decrypt</button>
    </div>
  </div>

  <div class="row">
      <div class="col form-group">
        <label for="encrypt">Encrypted Output:</label>
        <textarea class="form-control" rows="5" id="encrypt"></textarea>
      </div>
      <div class="col form-group">
        <label for="decrypt">Decrypted Output:</label>
        <textarea class="form-control" rows="5" id="decrypt"></textarea>
      </div>
    </div>

  <script>
      function genKeys(e) {
        e.preventDefault();
        alert('Not Implemented!');
        // 1. Find 2 prime numbers
        //     P = 5, Q = 11
        const P = randomPrime()
        const Q = randomPrime()
  
        // 2. Calculate the modulus
        //     M = P*Q
        //     M = 55

        const M = P * Q
  
        // 3. Calculate f(n)
        //     f(n) = (P - 1) * (Q - 1)
        //     4 * 10 = 40

        const fn = (P - 1) * (Q - 1)
  
        // 4. Find Relatively Prime numbers of f(n)
        //     3, 7, 9, 11, 13, 17, 19 ... (< f(n))
        //     using 7 for next step
  
        // 5. Public Key: (7, 55)
        //                 7: Public Encryption Exponent (P_E)
  
        // 6. Private Key Generation:
        //     (Public Encryption Exponent x Private Decryption Exponent) mod f(n) = 1
  
        // = (7*P_d) mod 40 = 1
  
        // P_d = 23
  
        // 7 * 23 = 161 mod 40 = 1
  
        // 7. Private Key (23, 55)
  
        // 8. Encryption process
        //     e = (p^{P_E})mod(m) where p is the plaintext
        //       = (2^7) mod 55
        //       = 18
  
        // 9. Decryption process
        //     p = (e^P_d) mod (m)
        //       = (18^23) mod (55)
        //       = 2

        var retPubKey = document.getElementById('pubKey')
        retPubKey.textContent += "Insert Public Key Here";
      }

      function randomPrime() {
        return getNextPrime(randomIntFromInterval(1, 94906265));
      }
      
      function genPriKey(e) {
        e.preventDefault();
        alert('Not Implemented');

        
        var retPriKey = document.getElementById('priKey')
        retPriKey.textContent += "Insert Private Key Here";
      }

      function isPrime(num) {
          if (num % 2 == 0) {
            return false;
          }
          const root = Math.sqrt(num);
          if (Number.isInteger(root)) { // If the root is an integer we skip a lot of checking here.
            return false;
          }
          // Composite number is always p * q, because of this,
          // the max that the lesser of {p, q} AKA ( max(min(p, q)) ),
          // could be is when p == q.
          // Therefore only need to check to sqrt(num)
          // Also, only need to check odd numbers (Technically only need 
          // to check prime numbers, but I'm not sure how to do that without 
          // ballooning complexity)
          for ( var i = 3; i < root; i += 2 ) {
              if ( num % i === 0 ) {
                  return false;
              }
          }
          return true;
      } 

      function randomIntFromInterval(min, max) { // min and max included 
        return Math.floor(Math.random() * (max - min + 1) + min);
      } 
      function getNextPrime(num) {
        // We only need to check odd numbers
        if ((num % 2) == 0) {
          num += 1;
        } else {
          num += 2;
        }
        while (!isPrime(num)) {
          num += 2;
        }
        return num
      }
      function getRelativePrime(num){
        return num - 1;
      }
  </script>
  <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
</body>
</html>
